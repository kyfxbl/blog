title: maven处理循环依赖
date: 2013-09-24 11:12
categories: java 
---
在多maven工程的项目里，如果工程间存在循环依赖，构建就会报错。本文介绍一下循环依赖要怎么处理
<!--more-->

# 循环依赖产生的原因

如果工程A依赖工程B，工程B又依赖工程A，就会形成循环依赖。或者A依赖B，B依赖C，C依赖A，也是循环依赖。总的来说，在画出工程依赖图之后，如果发现工程间的依赖连线形成了一个有向循环图，则说明有循环依赖的现象 

如果循环依赖发生在工程之间，则会影响构建，因为maven不知道应该先编译哪个工程。如果循环依赖发生在同一个工程的模块之间，虽然不影响编译，但是也是一种不好的实践，说明模块的设计有问题，应该避免 

如果在模块内部，有几个类互相调用的话，我觉得可能是正常的。比如观察者模式里面，Observer和Observable就是互相依赖的 

# 怎么解决循环依赖 

目前知道有2个办法可以解决 

第一个办法是用build-helper-maven-plugin插件来规避。比如A依赖B，B依赖C，C依赖A的情况。这个插件临时地将工程A、B、C合并成一个中间工程，编译出临时的模块D。然后A、B、C再分别依赖临时模块D进行编译 

第二个办法是通过重构，从根本上消除循环依赖，有2个思路

第一个办法是平移，比如A和B互相依赖，那么可以将B依赖A的那部分代码，移动到工程B中，这样一来，B就不需要继续依赖A，只要A依赖B就可以了，从而消除循环依赖 

第二个办法是下移，比如A和B互相依赖，同时它们都依赖C，那么可以将B和A相互依赖的那部分代码，移动到工程C里，这样一来，A和B相互之间都不依赖，只继续依赖C，也可以消除循环依赖